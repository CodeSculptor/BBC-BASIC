10MODE7:DIMM%(500)
20INPUT"Page of program to be Xpanded :&"PAGE$:CLS:PRINT'" Checking";
30PAGE%=EVAL("&"+PAGE$):A%=PAGE%+3:N%=0
40REPEATI%=-1:Q%=-1
50FORL%=A%+1TOA%+?A%-4
60IFINSTR("Üçîô",CHR$?L%)>0 I%=0
70IF?L%=42 AND(L%?-1=13ORL%?-4=13) I%=0
80IF?L%=&8D L%=L%+4
90IF?L%=34 Q%=NOTQ%
100IF?L%=58 ANDI% ANDQ% ANDL%?1<>58 M%(N%)=L%:?L%=13:N%=N%+1:VDU46
110NEXT:A%=A%+?A%
120IFA%?-3=13 UNTILA%?-2=&FF:GOTO140
130PRINT''"Bad program at &";~P%''"Recover ?":IFGET$="Y" A%!-3=&FF0D ELSEEND
140IFN%=0 PRINT". Can't expand.":PAGE=PAGE%:END
150IFPAGE%?1=&FF PAGE%?1=0
160M%(N%)=A%-1
170PRINTCHR$30'"Expanding";
180FORL%=N%TO1STEP-1:VDU58
190FORT%=M%(L%)TOM%(L%-1)STEP-1:?(L%*3+T%)=?T%:NEXT
200!(3*L%+T%-2)=&D:NEXT:A%=PAGE%
210PRINT''"Renumbering :";
220REPEATLINE%=A%?1*256+A%?2
230REPEATLEN%=0:A%=A%+3:REPEATA%=A%+1:LEN%=LEN%+1:UNTIL?A%=13
240A%?-LEN%=LEN%+3:PRINTTAB(13,VPOS);LINE%;
250IF!A%=&D LINE%=LINE%+1:A%?1=LINE%DIV256:A%?2=LINE%MOD256
260UNTIL!A%<>&D ORA%?1=&FF
270UNTILA%?1=&FF:PRINT''"Done.":PAGE=PAGE%:END